#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e
set -x

if [ "${BUILD_FILE_URL}" == "" ]; then
      echo "must set BUILD_FILE_URL"
      exit 1
fi

BUILD_DIR=$1
CACHE_DIR=$2

pushd "${BUILD_DIR}"
echo "-----> Bundling build ${BUILD_FILE_URL}"
[ ! -e "vendor" ] && mkdir vendor
curl --silent --max-time 60 --location "${BUILD_FILE_URL}" | tar xz -C vendor/ --keep-old-files
popd

# clean the cache
rm -rf "${CACHE_DIR}"
